<!--
SPDX-FileCopyrightText: 2023 Idiap Research Institute <contact@idiap.ch>

SPDX-FileContributor: Philip Abbet <philip.abbet@idiap.ch>

SPDX-License-Identifier: MIT
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <title>three.js example (JavaScript version)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <script id="mesh" type="data">
        [
            -0.017094, 0.378759, -0.089108,
            -0.020513, 0.053971, -0.048082,
            -0.020513, 0.060809, -0.024150,
            -0.020513, 0.368502, -0.102783,
            -0.027351, 0.047133, -0.051501,
            -0.027351, 0.648846, -0.075433,
            -0.034188, 0.238587, -0.075433,
            -0.034188, 0.324058, -0.099364,
            -0.034188, 0.539443, -0.034407,
            -0.037607, 0.306964, -0.072014,
            -0.041026, 0.074484, -0.058339,
            -0.041026, 0.077903, -0.027569,
            -0.041026, 0.105253, -0.037826,
            -0.041026, 0.108672, -0.065176,
            -0.041026, 0.313801, -0.089108,
            -0.041026, 0.365084, -0.102783,
            -0.044445, 0.368502, -0.072014,
            -0.044445, 0.621495, -0.116459,
            -0.047863, 0.118929, -0.068595,
            -0.047863, 0.334314, -0.109621,
            -0.047863, 0.375340, -0.089108,
            -0.047863, 0.635170, -0.013894,
            -0.051282, 0.067646, -0.058339,
            -0.051282, 0.132604, -0.068595,
            -0.054701, 0.334314, -0.075433,
            -0.054701, 0.389015, -0.102783,
            -0.054701, 0.566794, -0.082270,
            -0.058120, 0.334314, -0.095946,
            -0.058120, 0.525768, -0.078852,
            -0.061539, 0.539443, -0.072014,
            -0.068376, 0.457392, -0.030988,
            -0.068376, 0.624914, -0.030988,
            -0.068376, 0.747992, -0.078852,
            -0.071795, 0.026620, -0.024150,
            -0.071795, 0.327477, -0.058339,
            -0.071795, 0.494999, -0.075433,
            -0.071795, 0.614658, -0.085689,
            -0.075214, 0.529187, -0.089108,
            -0.078633, 0.009526, 0.010038,
            -0.078633, 0.296707, -0.058339,
            -0.078633, 0.563375, -0.089108,
            -0.082052, 0.501836, -0.085689,
            -0.085471, 0.532606, -0.075433,
            -0.085471, 0.563375, -0.078852,
            -0.085471, 0.724060, -0.017313,
            -0.088889, 0.351408, 0.006619,
            -0.088889, 0.358246, 0.033970,
            -0.088889, 0.474486, -0.072014,
            -0.088889, 0.508674, -0.075433,
            -0.088889, 0.604401, -0.072014,
            -0.088889, 0.703547, -0.119877,
            -0.092308, 0.238587, -0.058339,
            -0.092308, 0.334314, 0.047645,
            -0.092308, 0.597563, -0.089108,
            -0.095727, 0.310382, 0.064739,
            -0.099146, 0.481324, -0.089108,
            -0.099146, 0.539443, -0.106202,
            -0.102565, 0.033458, -0.024150,
            -0.102565, 0.279613, 0.074995,
            -0.102565, 0.324058, 0.010038,
            -0.102565, 0.590726, -0.078852,
            -0.105983, 0.488161, -0.078852,
            -0.105983, 0.539443, -0.095946,
            -0.109402, 0.125766, -0.048082,
            -0.109402, 0.214656, 0.081833,
            -0.109402, 0.638589, -0.078852,
            -0.112821, 0.296707, 0.010038,
            -0.116240, 0.074484, -0.037826,
            -0.116240, 0.501836, -0.106202,
            -0.116240, 0.580469, -0.106202,
            -0.119659, 0.505255, -0.095946,
            -0.119659, 0.577051, -0.095946,
            -0.119659, 0.618076, -0.085689,
            -0.123078, 0.607820, -0.082270,
            -0.126496, 0.122347, 0.085252,
            -0.136753, 0.242006, 0.003200,
            -0.136753, 0.713803, -0.113040,
            -0.140172, 0.765086, -0.068595,
            -0.143590, 0.019783, 0.023713,
            -0.143590, 0.033458, 0.078414,
            -0.143590, 0.642008, -0.072014,
            -0.147009, 0.611239, -0.075433,
            -0.147009, 0.621495, -0.078852,
            -0.147009, 0.734316, -0.007056,
            -0.153847, 0.129185, 0.003200,
            -0.153847, 0.423204, -0.017313,
            -0.153847, 0.447135, -0.061757,
            -0.153847, 0.484742, -0.099364,
            -0.153847, 0.491580, -0.089108,
            -0.153847, 0.539443, -0.109621,
            -0.153847, 0.590726, -0.089108,
            -0.153847, 0.597563, -0.099364,
            -0.153847, 0.631752, -0.061757,
            -0.153847, 0.659102, -0.017313,
            -0.160685, 0.043714, 0.020294,
            -0.164103, 0.440298, -0.054920,
            -0.164103, 0.460811, -0.072014,
            -0.164103, 0.471067, -0.065176,
            -0.174360, 0.412947, -0.041245,
            -0.181198, 0.604401, -0.075433,
            -0.184616, 0.607820, -0.085689,
            -0.188035, 0.624914, -0.061757,
            -0.191454, 0.371921, 0.020294,
            -0.191454, 0.392434, 0.047645,
            -0.191454, 0.505255, -0.082270,
            -0.191454, 0.577051, -0.082270,
            -0.191454, 0.672778, -0.095946,
            -0.194873, 0.501836, -0.089108,
            -0.194873, 0.580469, -0.089108,
            -0.201710, 0.484742, -0.054920,
            -0.201710, 0.662521, 0.064739,
            -0.205129, 0.539443, -0.078852,
            -0.208548, 0.477905, -0.061757,
            -0.208548, 0.539443, -0.085689,
            -0.211967, 0.676196, 0.010038,
            -0.215386, 0.460811, -0.041245,
            -0.215386, 0.696709, -0.048082,
            -0.218805, 0.474486, -0.048082,
            -0.218805, 0.604401, -0.048082,
            -0.232480, 0.580469, -0.044663,
            -0.239317, 0.457392, -0.000219,
            -0.239317, 0.525768, -0.041245,
            -0.239317, 0.624914, -0.000219,
            -0.242736, 0.556538, -0.041245,
            -0.246155, 0.539443, -0.041245,
            -0.246155, 0.587307, -0.051501,
            -0.252993, 0.518931, -0.044663,
            -0.256412, 0.559956, -0.048082,
            -0.263249, 0.433460, 0.071577,
            -0.263249, 0.597563, -0.037826,
            -0.270087, 0.457392, -0.020732,
            -0.273506, 0.515512, -0.030988,
            -0.273506, 0.539443, 0.006619,
            -0.276924, 0.416366, 0.016875,
            -0.276924, 0.631752, 0.129697,
            -0.280343, 0.563375, -0.030988,
            -0.297437, 0.631752, 0.037388,
            -0.300856, 0.614658, -0.065176,
            -0.311113, 0.645427, -0.020732,
            -0.317950, 0.522349, -0.010475,
            -0.317950, 0.611239, 0.105765,
            -0.324788, 0.597563, -0.034407,
            -0.338463, 0.505255, 0.088671,
            -0.348720, 0.611239, 0.051064,
            -0.362395, 0.498418, 0.057901,
            -0.376070, 0.621495, -0.007056,
            0.000000, 0.002689, -0.000219,
            0.000000, 0.019783, -0.027569,
            0.000000, 0.043714, -0.048082,
            0.000000, 0.050552, -0.048082,
            0.000000, 0.057390, -0.024150,
            0.000000, 0.091578, -0.034407,
            0.000000, 0.094997, -0.061757,
            0.000000, 0.098416, -0.068595,
            0.000000, 0.136023, -0.068595,
            0.000000, 0.238587, -0.075433,
            0.000000, 0.289870, -0.072014,
            0.000000, 0.293288, -0.089108,
            0.000000, 0.306964, -0.099364,
            0.000000, 0.344571, -0.109621,
            0.000000, 0.347990, -0.075433,
            0.000000, 0.351408, -0.095946,
            0.000000, 0.371921, -0.072014,
            0.000000, 0.453973, -0.065176,
            0.000000, 0.525768, -0.082270,
            0.000000, 0.587307, -0.106202,
            0.000000, 0.611239, -0.010475,
            0.000000, 0.621495, -0.072014,
            0.000000, 0.683034, 0.003200,
            0.017094, 0.378759, -0.089108,
            0.020513, 0.053971, -0.048082,
            0.020513, 0.060809, -0.024150,
            0.020513, 0.368502, -0.102783,
            0.027351, 0.047133, -0.051501,
            0.027351, 0.648846, -0.075433,
            0.034188, 0.238587, -0.075433,
            0.034188, 0.324058, -0.099364,
            0.034188, 0.539443, -0.034407,
            0.037607, 0.306964, -0.072014,
            0.041026, 0.074484, -0.058339,
            0.041026, 0.077903, -0.027569,
            0.041026, 0.105253, -0.037826,
            0.041026, 0.108672, -0.065176,
            0.041026, 0.313801, -0.089108,
            0.041026, 0.365084, -0.102783,
            0.044445, 0.368502, -0.072014,
            0.044445, 0.621495, -0.116459,
            0.047863, 0.118929, -0.068595,
            0.047863, 0.334314, -0.109621,
            0.047863, 0.375340, -0.089108,
            0.047863, 0.635170, -0.013894,
            0.051282, 0.067646, -0.058339,
            0.051282, 0.132604, -0.068595,
            0.054701, 0.334314, -0.075433,
            0.054701, 0.389015, -0.102783,
            0.054701, 0.566794, -0.082270,
            0.058120, 0.334314, -0.095946,
            0.058120, 0.525768, -0.078852,
            0.061539, 0.539443, -0.072014,
            0.068376, 0.457392, -0.030988,
            0.068376, 0.624914, -0.030988,
            0.068376, 0.747992, -0.078852,
            0.071795, 0.026620, -0.024150,
            0.071795, 0.327477, -0.058339,
            0.071795, 0.494999, -0.075433,
            0.071795, 0.614658, -0.085689,
            0.075214, 0.529187, -0.089108,
            0.078633, 0.009526, 0.010038,
            0.078633, 0.296707, -0.058339,
            0.078633, 0.563375, -0.089108,
            0.082052, 0.501836, -0.085689,
            0.085471, 0.532606, -0.075433,
            0.085471, 0.563375, -0.078852,
            0.085471, 0.724060, -0.017313,
            0.088889, 0.351408, 0.006619,
            0.088889, 0.358246, 0.033970,
            0.088889, 0.474486, -0.072014,
            0.088889, 0.508674, -0.075433,
            0.088889, 0.604401, -0.072014,
            0.088889, 0.703547, -0.119877,
            0.092308, 0.238587, -0.058339,
            0.092308, 0.334314, 0.047645,
            0.092308, 0.597563, -0.089108,
            0.095727, 0.310382, 0.064739,
            0.099146, 0.481324, -0.089108,
            0.099146, 0.539443, -0.106202,
            0.102565, 0.033458, -0.024150,
            0.102565, 0.279613, 0.074995,
            0.102565, 0.324058, 0.010038,
            0.102565, 0.590726, -0.078852,
            0.105983, 0.488161, -0.078852,
            0.105983, 0.539443, -0.095946,
            0.109402, 0.125766, -0.048082,
            0.109402, 0.214656, 0.081833,
            0.109402, 0.638589, -0.078852,
            0.112821, 0.296707, 0.010038,
            0.116240, 0.074484, -0.037826,
            0.116240, 0.501836, -0.106202,
            0.116240, 0.580469, -0.106202,
            0.119659, 0.505255, -0.095946,
            0.119659, 0.577051, -0.095946,
            0.119659, 0.618076, -0.085689,
            0.123078, 0.607820, -0.082270,
            0.126496, 0.122347, 0.085252,
            0.136753, 0.242006, 0.003200,
            0.136753, 0.713803, -0.113040,
            0.140172, 0.765086, -0.068595,
            0.143590, 0.019783, 0.023713,
            0.143590, 0.033458, 0.078414,
            0.143590, 0.642008, -0.072014,
            0.147009, 0.611239, -0.075433,
            0.147009, 0.621495, -0.078852,
            0.147009, 0.734316, -0.007056,
            0.153847, 0.129185, 0.003200,
            0.153847, 0.423204, -0.017313,
            0.153847, 0.447135, -0.061757,
            0.153847, 0.484742, -0.099364,
            0.153847, 0.491580, -0.089108,
            0.153847, 0.539443, -0.109621,
            0.153847, 0.590726, -0.089108,
            0.153847, 0.597563, -0.099364,
            0.153847, 0.631752, -0.061757,
            0.153847, 0.659102, -0.017313,
            0.160685, 0.043714, 0.020294,
            0.164103, 0.440298, -0.054920,
            0.164103, 0.460811, -0.072014,
            0.164103, 0.471067, -0.065176,
            0.174360, 0.412947, -0.041245,
            0.181198, 0.604401, -0.075433,
            0.184616, 0.607820, -0.085689,
            0.188035, 0.624914, -0.061757,
            0.191454, 0.371921, 0.020294,
            0.191454, 0.392434, 0.047645,
            0.191454, 0.505255, -0.082270,
            0.191454, 0.577051, -0.082270,
            0.191454, 0.672778, -0.095946,
            0.194873, 0.501836, -0.089108,
            0.194873, 0.580469, -0.089108,
            0.201710, 0.484742, -0.054920,
            0.201710, 0.662521, 0.064739,
            0.205129, 0.539443, -0.078852,
            0.208548, 0.477905, -0.061757,
            0.208548, 0.539443, -0.085689,
            0.211967, 0.676196, 0.010038,
            0.215386, 0.460811, -0.041245,
            0.215386, 0.696709, -0.048082,
            0.218805, 0.474486, -0.048082,
            0.218805, 0.604401, -0.048082,
            0.232480, 0.580469, -0.044663,
            0.239317, 0.457392, -0.000219,
            0.239317, 0.525768, -0.041245,
            0.239317, 0.624914, -0.000219,
            0.242736, 0.556538, -0.041245,
            0.246155, 0.539443, -0.041245,
            0.246155, 0.587307, -0.051501,
            0.252993, 0.518931, -0.044663,
            0.256412, 0.559956, -0.048082,
            0.263249, 0.433460, 0.071577,
            0.263249, 0.597563, -0.037826,
            0.270087, 0.457392, -0.020732,
            0.273506, 0.515512, -0.030988,
            0.273506, 0.539443, 0.006619,
            0.276924, 0.416366, 0.016875,
            0.276924, 0.631752, 0.129697,
            0.280343, 0.563375, -0.030988,
            0.297437, 0.631752, 0.037388,
            0.300856, 0.614658, -0.065176,
            0.311113, 0.645427, -0.020732,
            0.317950, 0.522349, -0.010475,
            0.317950, 0.611239, 0.105765,
            0.324788, 0.597563, -0.034407,
            0.338463, 0.505255, 0.088671,
            0.348720, 0.611239, 0.051064,
            0.362395, 0.498418, 0.057901,
            0.376070, 0.621495, -0.007056
        ]
    </script>

    <script id="line" type="data">
        [
            -0.136753, 0.713803, -0.113040,
            -0.088889, 0.703547, -0.119877,
            -0.044445, 0.621495, -0.116459,
            0.000000, 0.587307, -0.106202,
            0.000000, 0.525768, -0.082270,
            0.000000, 0.453973, -0.065176,
            0.054701, 0.389015, -0.102783,
            0.071795, 0.327477, -0.058339,
            0.078633, 0.296707, -0.058339,
            0.092308, 0.238587, -0.058339,
            0.109402, 0.125766, -0.048082,
            0.116240, 0.074484, -0.037826,
            0.102565, 0.033458, -0.024150
        ]
    </script>
</head>


<body style="font-family: MONOSPACE;">
    <h2>three.js example (JavaScript version)</h2>

    <p>This example shows how to directly interact with the three.js scene at the core of a 3D viewer. It is a simpler version
        of <a href="three.html">three.html</a>.</p>

    <p>The point cloud and the trajectory data are hard-coded in the HTML file.</p>

    <div id="viewer3d" style="height: 700px"></div>


    <!-- Import all the necessary JavaScript dependency modules
    Sadly, can't be imported from an external file for the moment, this is not supported by Chrome
    -->
    <script src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.141.0/build/three.module.js",
                "three/examples/jsm/": "https://cdn.jsdelivr.net/npm/three@0.141.0/examples/jsm/",
                "mujoco": "../../dist/jsm/mujoco_wasm.js",
                "katex": "https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.mjs",
                "mathjs": "https://cdn.jsdelivr.net/npm/mathjs@12.0.0/+esm"
            }
        }
    </script>


    <!-- Create the Viewer3D from JavaScript -->
    <script type="module">
        import * as THREE from 'three';
        import { Viewer3D } from '../../dist/viewer3d.js';

        // Create the Viewer3D
        const viewer3D = new Viewer3D(document.getElementById('viewer3d'));

        // Set the background color
        viewer3D.backgroundColor = new THREE.Color(0.9, 0.9, 0.9);

        // Create the point mesh
        const vertices = JSON.parse(document.querySelector("#mesh").text);

        let geometry = new THREE.BufferGeometry();
        geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));

        let material = new THREE.PointsMaterial({ color: 0x0000CC, size: 0.01 });
        const mesh = new THREE.Points(geometry, material);

        viewer3D.scene.add(mesh);

        // Create the line
        const points = JSON.parse(document.querySelector("#line").text);

        geometry = new THREE.BufferGeometry();
        geometry.setAttribute('position', new THREE.Float32BufferAttribute(points, 3));

        material = new THREE.LineBasicMaterial({ color: 0x000000 });

        const line = new THREE.Line(geometry, material);
        viewer3D.scene.add(line);

        // Manually position the camera
        viewer3D.camera.position.set(0.4, 0.7, -1);
        viewer3D.cameraControl.target.set(0.0, 0.4, 0.0);
        viewer3D.cameraControl.update();
    </script>
</body>
</html>
